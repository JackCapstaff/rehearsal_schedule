{% extends "base.html" %}
{% set title = ("Edit Concert" if concert else "Add Concert") + " - " + ensemble.name %}
{% set subtitle = ensemble.name %}

{% block content %}
  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:baseline; gap:12px;">
      <div>
        <strong>{% if concert %}Edit Concert{% else %}Add Concert{% endif %}</strong>
      </div>
      <div>
        <a class="btn secondary" href="{{ url_for('admin_view_concerts', ensemble_id=ensemble.id) }}">Back to Concerts</a>
      </div>
    </div>
  </div>

  <div class="card">
    <form method="post" style="display:flex; flex-direction:column; gap:16px;">
      <div>
        <label for="title"><strong>Concert Title</strong></label>
        <input 
          type="text" 
          id="title" 
          name="title" 
          placeholder="e.g., Spring Concert 2026"
          value="{{ concert.title | default('', true) }}"
          required
          style="width:100%; padding:10px; box-sizing:border-box;">
      </div>

      <div>
        <label for="date"><strong>Date</strong></label>
        <input 
          type="date" 
          id="date" 
          name="date" 
          value="{{ concert.date | default('', true) }}"
          required
          style="width:100%; padding:10px; box-sizing:border-box;">
      </div>

      <div>
        <label for="time"><strong>Time</strong></label>
        <input 
          type="time" 
          id="time" 
          name="time" 
          value="{{ concert.time | default('', true) }}"
          style="width:100%; padding:10px; box-sizing:border-box;">
      </div>

      <div>
        <label for="venue"><strong>Venue</strong></label>
        <input 
          type="text" 
          id="venue" 
          name="venue" 
          placeholder="e.g., Royal Concert Hall"
          value="{{ concert.venue | default('', true) }}"
          style="width:100%; padding:10px; box-sizing:border-box;">
      </div>

      <div>
        <label for="uniform"><strong>Uniform</strong></label>
        <input 
          type="text" 
          id="uniform" 
          name="uniform" 
          placeholder="e.g., Black tie"
          value="{{ concert.uniform | default('', true) }}"
          style="width:100%; padding:10px; box-sizing:border-box;">
      </div>

      <div>
        <label for="programme"><strong>Programme</strong></label>
        <textarea 
          id="programme" 
          name="programme" 
          placeholder="e.g., Set 1: Works 1-3&#10;Set 2: Works 4-6"
          style="width:100%; padding:10px; box-sizing:border-box; min-height:100px; font-family:monospace;">{{ concert.programme | default('', true) }}</textarea>
      </div>

      <div>
        <label for="other_info"><strong>Other Info</strong></label>
        <textarea 
          id="other_info" 
          name="other_info" 
          placeholder="Any additional notes..."
          style="width:100%; padding:10px; box-sizing:border-box; min-height:80px;">{{ concert.other_info | default('', true) }}</textarea>
      </div>

      <div>
        <label for="schedule_id"><strong>Linked Rehearsal Schedule (optional)</strong></label>
        <select 
          id="schedule_id" 
          name="schedule_id"
          style="width:100%; padding:10px; box-sizing:border-box;">
          <option value="">— No schedule linked —</option>
          {% for sched in schedules %}
            <option value="{{ sched.id }}" {% if concert and concert.schedule_id == sched.id %}selected{% endif %}>
              {{ sched.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label for="status"><strong>Status</strong></label>
        <select 
          id="status" 
          name="status"
          style="width:100%; padding:10px; box-sizing:border-box;">
          <option value="scheduled" {% if not concert or concert.status == 'scheduled' %}selected{% endif %}>Scheduled</option>
          <option value="completed" {% if concert and concert.status == 'completed' %}selected{% endif %}>Completed</option>
          <option value="cancelled" {% if concert and concert.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
        </select>
      </div>

      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <a class="btn secondary" href="{{ url_for('admin_view_concerts', ensemble_id=ensemble.id) }}">Cancel</a>
        <button class="btn" type="submit">{% if concert %}Save Changes{% else %}Create Concert{% endif %}</button>
      </div>
    </form>
  </div>

{% endblock %}
